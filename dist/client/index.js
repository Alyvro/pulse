import{useEffect as y,useState as p}from"react";import{nanoid as T}from"nanoid";var S="APWP",u="|";var g=e=>{let t=1,s=0;for(let r=0;r<e.length;r++)t=(t+e.charCodeAt(r))%65521,s=(s+t)%65521;return(s<<16|t).toString(16)};var l=e=>{if(!e.startsWith(S))return null;let t=e.split(u);if(t.length!==8)return null;let[s,r,c,a,o,i,n,d]=t,f=t.slice(0,7).join(u),m=g(f);if(d!==m)return null;try{let N=typeof window>"u"?Buffer.from(n,"base64").toString():atob(n);return{id:a,op:parseInt(c),channel:i,payload:JSON.parse(N),timestamp:parseInt(o,36)}}catch{return null}};var h=(e,t="/api/pulse")=>{let[s,r]=p(null),[c,a]=p("CONNECTING");return y(()=>{let o=new EventSource(t);return o.onopen=()=>{},o.onmessage=i=>{let n=l(i.data);n&&(n.op===1?a("CONNECTED"):n.op===3&&n.channel===e&&r(n.payload))},o.onerror=()=>{a("DISCONNECTED"),o.close()},()=>{o.close()}},[e,t]),{data:s,status:c}};export{h as usePulse};
//# sourceMappingURL=index.js.map