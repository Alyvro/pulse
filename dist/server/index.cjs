"use strict";var d=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var S=(n,t)=>{for(var e in t)d(n,e,{get:t[e],enumerable:!0})},P=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of A(t))!x.call(n,o)&&o!==e&&d(n,o,{get:()=>t[o],enumerable:!(s=$(t,o))||s.enumerable});return n};var R=n=>P(d({},"__esModule",{value:!0}),n);var E={};S(E,{pulse:()=>w});module.exports=R(E);var b=require("next/server"),g=require("events");var m=require("nanoid"),T="APWP",r="|";var k=n=>{let t=1,e=0;for(let s=0;s<n.length;s++)t=(t+n.charCodeAt(s))%65521,e=(e+t)%65521;return(e<<16|t).toString(16)},f=(n,t,e)=>{let s=(0,m.nanoid)(6),o=Date.now().toString(36),a=JSON.stringify(e),i=typeof window>"u"?Buffer.from(a).toString("base64"):btoa(a),u=`${T}${r}1${r}${n}${r}${s}${r}${o}${r}${t}${r}${i}`,c=k(u);return`${u}${r}${c}`};var p=class{constructor(){this.bus=new g.EventEmitter;this.bus.setMaxListeners(0)}emit(t,e){this.bus.emit("broadcast",{channel:t,data:e})}Handler(){return t=>{let e=new TextEncoder,s=new ReadableStream({start:o=>{let a=(c,l,h)=>{let y=f(c,l,h);o.enqueue(e.encode(`data: ${y}

`))};a(1,"system",{status:"ok"});let i=({channel:c,data:l})=>{a(3,c,l)};this.bus.on("broadcast",i);let u=setInterval(()=>{a(2,"system",{})},15e3);t.signal.addEventListener("abort",()=>{this.bus.off("broadcast",i),clearInterval(u),o.close()})}});return new b.NextResponse(s,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform",Connection:"keep-alive","X-Accel-Buffering":"no"}})}}},w=new p;0&&(module.exports={pulse});
//# sourceMappingURL=index.cjs.map