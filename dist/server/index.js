import{NextResponse as g}from"next/server";import{EventEmitter as $}from"events";import{nanoid as y}from"nanoid";var b="APWP",s="|";var h=r=>{let t=1,e=0;for(let n=0;n<r.length;n++)t=(t+r.charCodeAt(n))%65521,e=(e+t)%65521;return(e<<16|t).toString(16)},p=(r,t,e)=>{let n=y(6),c=Date.now().toString(36),o=JSON.stringify(e),i=typeof window>"u"?Buffer.from(o).toString("base64"):btoa(o),u=`${b}${s}1${s}${r}${s}${n}${s}${c}${s}${t}${s}${i}`,a=h(u);return`${u}${s}${a}`};var d=class{constructor(){this.bus=new $;this.bus.setMaxListeners(0)}emit(t,e){this.bus.emit("broadcast",{channel:t,data:e})}Handler(){return t=>{let e=new TextEncoder,n=new ReadableStream({start:async c=>{let o=(a,l,m)=>{let f=p(a,l,m);c.enqueue(e.encode(`data: ${f}

`))};o(1,"system",{status:"ok"});let i=({channel:a,data:l})=>{o(3,a,l)};this.bus.on("broadcast",i);let u=setInterval(()=>{o(2,"system",{})},15e3);t.signal.addEventListener("abort",()=>{this.bus.off("broadcast",i),clearInterval(u),c.close()})}});return new g(n,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}}},w=new d;export{w as pulse};
//# sourceMappingURL=index.js.map